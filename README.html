<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="pairing-employees-for-15-minute-coffee-meeting">Pairing employees for 15-minute coffee meeting</h1>
<h2 id="bertrand-blanc-cist-005b">Bertrand Blanc CIST-005B</h2>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#Assignment_description">Assignment description</a></li>
<li><a href="#Rough_complexity_analysis">Rough complexity analysis</a></li>
<li><a href="#Proposed_algorithm">Proposed algorithm</a></li>
<li><a href="#Timing_management">Timing management</a></li>
<li><a href="#Technical_learning_through_this_project">Technical learning through this project</a></li>
<li><a href="#Program_s_execution">Program's execution</a></li>
<li><a href="#UML_Class_Diagram">UML Class Diagram</a></li>
<li><a href="#Conclusion">Conclusion</a></li>
</ol>
<h2 id="assignment-description-a-name%22assignmentdescription%22a">Assignment description <a name="Assignment_description"></a></h2>
<p>A manager of a department at Google wants to schedule 15-minute coffee chat between two employees every week for his 6 employees. Design and write a program to help this manager.</p>
<ul>
<li>Each employee should have a meeting with a new person. So, no meeting with the same person until they meet all the other colleagues.</li>
<li>Use functional programming or object-oriented programing.
You can have your own design to cover the requirements but you should consider a design with better time complexity.</li>
<li>You can use any data structures (lists, dictionaries, stacks, queues, ...)</li>
<li>The number 6 here is an example and imaging there are &quot;n&quot; (an even number) employees in the group (for this example n=6)</li>
<li>Every week each employee should have a meeting and just one meeting with one person.</li>
<li>Every week they should have a meeting with a new person.</li>
</ul>
<h2 id="rough-complexity-analysis-a-name%22roughcomplexityanalysis%22a">Rough complexity analysis <a name="Rough_complexity_analysis"></a></h2>
<p>Be $n$ the number of employees to be paired up every week.</p>
<p>Every week, $n/2$ unique new pairs are created.</p>
<p>Hence, $n-1$ weeks are needed to have all $n$ employees meeting each other once</p>
<ul>
<li>
<p>$meeting_k = (employee_i, employee_j)_k, (i,j) \in [0,n[^2, i \neq j, k \in [0,\frac{n^2-n}{2}[$</p>
</li>
<li>
<p>$week_k = {meeting_{t}}_{t \in [0, \frac{n}{2}[}, k \in [0, n[$</p>
</li>
<li>
<p>$\forall i, j \in I_n, i \neq j, week_i \cap week_j = \emptyset$</p>
</li>
</ul>
<p>Thus,</p>
<p>Finding a valid $week_k$ would require exploring the different sequences of $\frac{n}{2}$ employees among the $\frac{n^2-n}{2}$ possible pairs of employees.</p>
<p>The combination of $r$ elements among a total of $n$ employees is $\binom{n}{r} = \frac{n!}{(n-r)!r!}$</p>
<p>Hence the number of combinations to explore to find the $n-1$ weeks of unique pairs of employees for $\frac{n}{2}$ meetings a week ends up being an exponential problem with a complexity of $O(2^n)$.</p>
<p>Once a set of $n-1$ sequence of $\frac{n}{2}$ meetings is found, verifying that each employee meets only once a week for $n-1$ weeks would require $\frac{n(n+1)}{2} \in O(n^2)$ operations.</p>
<p>In sum, finding a solution to the problem requires an exponential complexity, while verifying such solution could be done in polynomial time. Comsequently, such problem belongs to the class of $NP$-complete problems.</p>
<p>Obviously, some heuristics exist based on the provided constraints to reduce the realm of possibilities.</p>
<p>For example, with $n=10$, the $5$ meetings are drawn from $\binom{45}{5} = 17,593,329,600$ possibilites. Obviously, no decent algorithm can explore so many possibilities in reasonable time. The constraint that an employee can only meet once in a week, helps reducing these possibilities. Such heuristics don't change the non-polynomial nature of this problem.</p>
<h2 id="proposed-algorithm-a-name%22proposedalgorithm%22a">Proposed algorithm <a name="Proposed_algorithm"></a></h2>
<p>My assumption is that each sequence of $\frac{n}{2}$ meetings satisfying the properties mentioned above is a correct sequence based on the known context from the previous weeks.</p>
<p>If $n-1$ weeks can be found in sequence verifying such constraints, then this sequence is a solution to the problem.</p>
<p>Finding a sequence for a week explores all pairs of employees, hence up to $(n-1)*n^2 \in O(n^3)$ operations with a lot of weeding since we know such pairs shall be unique.</p>
<p>How to find such sequences?</p>
<p>I chose to sort the employees according to the other employees they have to still meet. A graph structure was hence well-suited to capture such topography.</p>
<p>Example for $n = 4$, we can represent the $\frac{n^2-n}{2} possibilities as a triangular matrix or as a bubble diagram.</p>
<table>
<thead>
<tr>
<th>employees</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>N/A</td>
<td>to meet</td>
<td>to meet</td>
<td>to meet</td>
</tr>
<tr>
<td>2</td>
<td>N/A</td>
<td>N/A</td>
<td>to meet</td>
<td>to meet</td>
</tr>
<tr>
<td>3</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>to meet</td>
</tr>
<tr>
<td>4</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<p><img src="./documentation/bubble_02.svg" alt="bubble"></p>
<p>I sorted the vertices according to 5 different methods:</p>
<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>least neighbors first, smallest ID first</td>
<td>${employee_3, employee_2, employee_1}$</td>
</tr>
<tr>
<td>1</td>
<td>most neighbors first, smallest ID first</td>
<td>${employee_1, employee_2, employee_3}$</td>
</tr>
<tr>
<td>2</td>
<td>most neighbors first, highest ID first</td>
<td>${employee_1, employee_2, employee_3}$</td>
</tr>
<tr>
<td>3</td>
<td>least neighbors first, highest ID first</td>
<td>${employee_3, employee_2, employee_1}$</td>
</tr>
<tr>
<td>4</td>
<td>random selection</td>
<td>${employee_2, employee_3, employee_1}$ among $3!$ possibilites</td>
</tr>
</tbody>
</table>
<p>The strategy is to explore each of these sorting methods until one works. It is possible that none of them would work for two reasons:</p>
<ol>
<li>none of them end up with a valid sequence of $n-1$ $\frac{n}{2}$-meetings</li>
<li>the time to explore the sequences takes unreasonable time, hence aborted</li>
</ol>
<p>In the following example for $n=4$, the second sorting algorith was used (most neighbors first, smallest ID first). After three weeks, all employees have met: no vertex remain in the graph.</p>
<p><img src="./documentation/bubble_01.svg" alt="bubble"></p>
<h2 id="timing-management-a-name%22timingmanagement%22a">Timing management <a name="Timing_management"></a></h2>
<p>As previously seen, an algorithm (or all) may not terminate timely. To &quot;<em>give a chance</em>&quot; to each sorting algorithm, I implemented a timeout using a multi-threading approach. Each algorithm has a certain amount of time to finish, if not, the timeout kils its execution, to move to the next sorting method.</p>
<p>According to the number of nodes to process, it may be reasonable to increase the timeout. For example, up to 32 employees, 1 second is enough to complete. Above 32, no algorithm can finish within 1 second, hence increasing the throttle to a 5-second timeout.</p>
<p>I implemented a basic timeout as follow.</p>
<pre><code>from threading import Thread, Event
import time

def timeout(timer:int, signal:Event) -&gt; None
    time.sleep(timer)
    signal.set()

def function_to_run(&lt;parameters&gt;, signal:Event, result:List) -&gt; None
    # the code is instrumented in a way that it is sensitive
    # to signal.is_set() to elegantly abort its own execution

    # the result is provided by reference via result[0]

def arbiter(time_slice):
    signal = Event()
    result = [None]

    timer = Thread(target=timeout, kwargs={'timer':time_slice, 'signal':signal})
    algo = Thread(target=function_to_run, args=(&lt;parameters&gt;), kwargs={'signal':signal, 'result':result}

    algo.start()
    timer.start() 

    timer.join()
    algo.join()

    if result[0] is None:
        # function_to_run execution was killed
    else:
        # function_to_run successfully completed
</code></pre>
<h2 id="technical-learning-through-this-project-a-name%22technicallearningthroughthisproject%22a">Technical learning through this project <a name="Technical_learning_through_this_project"></a></h2>
<p>I needed to log the time the different algorithms needed to run to give me an idea about the scale. To do so, I created a class-based decorator with dual purpose: logging the time and/our acting as a timeout to exit the program. I run the wrapped function as a daemon in the background using the <a href="https://docs.python.org/3/library/threading.html"><em>threading</em> module</a>: the function doesn't have to be instrumented to elegantly abort iteself. When the allotted time has reached, the main thread returns. I'm skeptical about this method, since the thread is left to die, the usage of a <a href="https://docs.python.org/3/library/multiprocessing.html"><em>Process</em> with a <em>terminate()</em> method</a> may be more appropriate. See <a href="decorator_timer.py">decorator_timer.py</a> Python file. A stub for a class-based decorator looks as follow:</p>
<pre><code>class decorator():
    def __init__(self, *args, **kargs):
        # initialize the instance attributes

    def __call__(self, func):
    # dunder magic method invoked by the decorator

        @functools.wraps(func) # this decorator allows the python help to properly display the arguments 
        def wrapper(*args, **kargs):
            # instrumentation
            result = func(*args, **kargs)
            # more instrumentation
            return result
    return wrapper
</code></pre>
<p>In order to present a nicely packaged command line interface, I used <a href="https://docs.python.org/3/library/argparse.html">the module <em>argparse</em></a> in the file (main.py)[main.py] as follow:</p>
<pre><code>    parser = argparse.ArgumentParser(
        prog='main.py',
        description='Creates the weekly coffee pairing for the employees',
        epilog='Thanks for using my program',
    )

    parser.add_argument('--author', help=&quot;author&quot;, action='store_true')

    parser.add_argument('--sorting', help=&quot;sorting mechanism to use. Different sorting strategies&quot;, nargs='?', type=int, default=-1, choices=[0,1,2,3,4])

    parser.add_argument('--timer', help=&quot;enables the timer to monitor the elapsed time&quot;, action='store_true')

    parser.add_argument('--timeout', help=&quot;aborts the execution after N seconds. Dafault to 1s. May help giving more time to complete&quot;, action='store', type=int, metavar='N', default=1)

    parser.add_argument('--employees', '-e', help=&quot;number of employees&quot;, action='store', type=int, metavar='&lt;integer&gt;')

    parser.add_argument('--weeks', '-w', help=&quot;generate the pairing for this number of weeks&quot;, action='store', type=int, metavar='&lt;integer&gt;')
</code></pre>
<p>Usually I write documents using MS-Word and various sources of media like images. To write this document, I used <em>Markdown</em> (MD) which seems to be a popular documentation-oriented textual format. I was acquainted with this format while using GitHub. The learning curve to use it is quite quick using <a href="https://www.markdownguide.org/basic-syntax/">basic syntax</a> like title, paragraphs, image insertion, or <a href="https://markdownguide.offshoot.io/extended-syntax/">more advanced syntax</a> like tables, <a href="https://pdf.plantuml.net/1.2020.22/PlantUML_Language_Reference_Guide_en.pdf">plantUML</a> inserts or <a href="https://quickref.me/latex">$LaT\epsilon \Chi$</a> for mathematical expressions. Unfortunately, the plantUML and $LaT\epsilon \Chi$ inserts are not converted by the HTML or PDF extension I used in my Visual Studio IDE.</p>
<h2 id="programs-execution-a-name%22programsexecution%22a">Program's execution <a name="Program_s_execution"></a></h2>
<p>Run the command without argument or with the option -h/--help to get a description of the Command Line Interface (CLI).
For a given number of employees N, the program finds N-1 unique N//2 pairs.</p>
<pre><code>$&gt; py ./main.py                           
usage: main.py [-h] [--author] [--sorting [{0,1,2,3,4}]] [--timer] [--timeout N] --employees &lt;integer&gt; [--weeks &lt;integer&gt;]

Creates the weekly coffee pairing for the employees

options:
  -h, --help            show this help message and exit
  --author              author
  --sorting [{0,1,2,3,4}]
                        sorting mechanism to use. Different sorting strategies
  --timer               enables the timer to monitor the elapsed time
  --timeout N           aborts the execution after N seconds. Dafault to 1s. May help giving more time to complete
  --employees &lt;integer&gt;, -e &lt;integer&gt;
                    number of employees
  --weeks &lt;integer&gt;, -w &lt;integer&gt;
                    generate the pairing for this number of weeks

Thanks for using my program
</code></pre>
<p>A few examples of outputs follow. More examples can be found in the file <a href="examples.txt">examples.txt</a></p>
<pre><code>$&gt; py ./main.py --employees 6
Employees: [E001, E002, E003, E004, E005, E006]
week 1: [(E003, E006), (E002, E005), (E001, E004)]
week 2: [(E004, E006), (E002, E003), (E001, E005)]
week 3: [(E001, E002), (E003, E004), (E005, E006)]
week 4: [(E003, E005), (E002, E004), (E001, E006)]
week 5: [(E001, E003), (E002, E006), (E004, E005)]
</code></pre>
<p>or</p>
<pre><code>$&gt; py ./main.py --employees 10 --sorting 1
Employees: [E001, E002, E003, E004, E005, E006, E007, E008, E009, E010]
week 1: [(E001, E010), (E002, E009), (E003, E008), (E004, E007), (E005, E006)]
week 2: [(E001, E009), (E002, E010), (E003, E007), (E004, E005), (E006, E008)]
week 3: [(E001, E005), (E006, E010), (E003, E009), (E007, E008), (E002, E004)]
week 4: [(E001, E003), (E004, E010), (E005, E008), (E007, E009), (E002, E006)]
week 5: [(E003, E006), (E008, E009), (E005, E010), (E002, E007), (E001, E004)]
week 6: [(E001, E002), (E009, E010), (E004, E008), (E003, E005), (E006, E007)]
week 7: [(E006, E009), (E003, E004), (E008, E010), (E002, E005), (E001, E007)]
week 8: [(E005, E009), (E004, E006), (E002, E003), (E007, E010), (E001, E008)]
week 9: [(E001, E006), (E002, E008), (E003, E010), (E004, E009), (E005, E007)]
</code></pre>
<h2 id="uml-class-diagram-a-name%22umlclassdiagram%22a">UML Class Diagram <a name="UML_Class_Diagram"></a></h2>
<p><img src="coffee.svg" alt="UML class diagram"></p>
<h2 id="conclusion-a-name%22conclusion%22a">Conclusion <a name="Conclusion"></a></h2>
<p>To conclude, up to 40 nodes can be processed within reasonable time.</p>
<p>Instead of using threads, I could have used the <em>multiprocessing</em> module to eventually kill the processes using SIGTERM or SIGKILL signals natively implemented via the <em>Process.terminate()</em> or <em>Process.kill()</em> methods. Such approach would prevent having to instrument the code to be sensitive to an external signal to abort itself. However, a SIGKILL signal may have left the data in an unstable state. The threading approach allows to choose when and how to abort self, hence ensuring the data are still consistent.</p>
<p>I'd also like to experiment with other sorting algorithm, eventually running all of them concurrently. Such strategy seems resource consumming. It may be unlikely that my laptop has enough resources to handle such amount of resources (CPU, RAM, threads limit,...).</p>

</body>
</html>
